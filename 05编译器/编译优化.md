编译有2个执行时机
+ 构建时编译 Ahead Of Time 预编译
+ 运行时编译 Just In Time 即时编译

AOT可以提前进行编译，用户直接运行编译后的代码，减少首屏时间
JIT可以减少、没有编译阶段，但是应用体积会更大，因为要包含编译的相关逻辑；并且运行时编译，运行性能不占优势

现在前端框架，一般都有AOT编译这一步骤
+ 代码转换，ts转为js、vue转为js
+ 编译优化
+ 代码压缩、打包


AOT能对模板语法编译进行优化
可以减少根据state计算UI变化的花销
因为模板语法是固定的，相对js语法，灵活度低，分析难度低，可以确定模板的动态部分和静态部分，针对静态部分做标记，运行时直接忽略，提升性能


## 传统Diff算法的问题

对比新旧两颗虚拟DOM树的时候，
总是要按照虚拟DOM的层级结构，一层一层的遍历对比

先对比DOM树根节点的变化，是否有props、attrs、class、style、event是的变化；再对比children是否有变化
children对比，也是按照这个顺序，递归的对比

即使是静态节点，也会参与对比，存在许多无意义的对比

实际上模板的结构非常稳定，在编译阶段，就可以确定出来哪些是静态节点
哪些是动态节点，以及动态节点具体哪些信息是动态的，是props、class、style、events的哪一种，进行靶向更新

编译器在编辑时提取到这些关键信息，将其附着在虚拟DOM上
> 虚拟DOM上增加了一个属性，`dynamicChildren` 记录虚拟DOM树上的所有动态节点

渲染器在运行时，可以根据这些信息，在Dom Diff的过程中，跳过静态节点、直接对比动态节点，然后对比动态节点的动态信息

### Block 和 patchFlags

Block 本质上也是一个虚拟DOM
只不过，Block是一个虚拟DOM里面所有动态节点的集合，并且Block没有层级关系，所有节点都是平铺的

渲染器的更新操作，将以Block为维度


Block 节点
+ template的根节点
+ v-for指令的节点
+ v-if/v-else-if/v-else 指令的节点


